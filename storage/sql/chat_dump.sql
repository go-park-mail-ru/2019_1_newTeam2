USE chat_wordtrainer;

DROP TABLE IF EXISTS message_in_dialog;
DROP TABLE IF EXISTS dialog;
DROP TABLE IF EXISTS broadcast_dialog;
DROP TABLE IF EXISTS message;
DROP TABLE IF EXISTS user;
DROP TABLE IF EXISTS word;

CREATE TABLE user (
    ID INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    Username VARCHAR(255) NOT NULL UNIQUE
);

CREATE TABLE message (
    ID INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    data TEXT,
    UserId INT UNSIGNED NOT NULL,
    FOREIGN KEY (UserId) REFERENCES message (ID)
);

CREATE TABLE dialog (
    ID INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    MessageId INT UNSIGNED NOT NULL,
    FOREIGN KEY (MessageID) REFERENCES message (ID)
);

CREATE TABLE message_in_dialog (
    ID INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    DialogId INT UNSIGNED NOT NULL,
    MessageId INT UNSIGNED NOT NULL,
    FOREIGN KEY (DialogId) REFERENCES dialog (ID),
    FOREIGN KEY (MessageId) REFERENCES message (ID)
);

CREATE TABLE broadcast_dialog (
    ID INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    MessageId INT UNSIGNED NOT NULL,
    UserId INT UNSIGNED NOT NULL,
    FOREIGN KEY (MessageId) REFERENCES message (ID),
    FOREIGN KEY (UserId) REFERENCES user (ID)
);